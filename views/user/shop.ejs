<%- include('../layouts/userheader.ejs') %>

<main class="main">
  <div class="container">
    <div class="row">
      <!-- Sidebar Section for Category and Sorting -->
      <div class="col-lg-3">
        <div class="primary-sidebar sticky-sidebar">
          <!-- Category Section -->
          <div class="widget-category mb-30 mt-60">
            <h5 class="section-title style-1 mb-30 wow fadeIn animated">Category</h5>
            <ul class="categories">
              <li><a href="/shop"><option value="">All</option></a></li>
              <% categories.forEach(category=> { if (category.is_listed) { %>
              <li>
                <a href="shopCategoryFilter?id=<%= category._id %>" >
                  <option value="<%= category._id %>"><%= category.name %></option>
                </a>
              </li>
              <% } }); %>
            </ul>
          </div>
          <!-- Sorting Section -->
          <div class="widget-category mb-30">
            <h5 class="section-title style-1 mb-30 wow fadeIn animated">Sorting by price:</h5>
            <ul>
              <li><a class="active" href="/shop">Featured</a></li>
              <li><a href="/shop?sort=asc">Price: Low to High</a></li>
              <li><a href="/shop?sort=dsc">Price: High to Low</a></li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Product Section -->
      <div class="col-lg-9">
        <div class="shop-product-fillter">
          <div class="totall-product">
            <p class="mt-30">We found <strong class="text-brand">688</strong> items for you!</p>
          </div>
          <div class="sort-by-product-area"></div>
        </div>
        <div  id="Grid"   class="row product-grid-3">
          <% for (const product of products) { 
            if (product.is_listed ) {
              const categoryId = product.category; 
              categories.forEach(category => { 
                if (categoryId.toString() === category._id.toString()) { 
                  if (category.is_listed) { %>
                    <!-- Product Card -->
                    <div class="col-lg-4 col-md-4 col-12 col-sm-6">
                      <div  id="product"  class="product-cart-wrap mb-30">
                        <!-- Product Image -->
                        <div class="product-img-action-wrap">
                          <div class="product-img product-img-zoom">
                            <a href="/singleProduct/<%= product._id%>">
                              <img
                                class="default-img"
                                src="/adminassets/imgs/productIMG/<%= product.image[0]%>"
                                alt="<%= product.name %>"
                              />
                              <!-- Add additional images if needed -->
                              <!-- <img class="hover-img" src="/adminassets/imgs/productIMG/<%= product.image[1]%>" alt="<%= product.name %>" /> -->
                            </a>
                          </div>
                          <div class="product-badges product-badges-position product-badges-mrg">
                            <span class="hot">Hot</span>
                          </div>
                        </div>
                        <!-- Product Details -->
                        <div class="product-content-wrap">
                          <div class="product-category">
                            <a href="shop-grid-right.html">Music</a>
                          </div>
                          <h2><a href="/singleProduct/<%= product._id%>"><%= product.name %></a></h2>
                          <!-- Add more product details as needed -->
                          <div class="rating-result" title="90%">
                            <span>
                              <span>90%</span>
                            </span>
                          </div>
                          <div class="product-price">
                            <% if (product.discount_price) { %>
                            <span>₹<%= product.discount_price %> </span>
                            <span class="old-price">- ₹<s><%= product.price %></s></span>
                            <% } else { %>
                            <span class="old-price"> ₹<%= product.price %></span>
                            <% } %>
                          </div>
                          <!-- Add the form for adding to cart if needed -->
                          <form id="myForm" action="/cart" method="post">
                            <div class="product-action-1 show">
                              <input type="hidden" value="<%= product._id %>" name="productData_id">
                              <input type="hidden" value="1" name="qty">
                              <button type="button" aria-label="Add To Cart" class="action-btn hover-up">
                                <i class="fi-rs-shopping-bag-add"></i>
                              </button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  <% } 
                } 
              }); 
            } 
          } %>
        </div>

        <!-- Pagination Section -->
        <div class="pagination-area mt-15 mb-sm-5 mb-lg-0">
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-start mb-30">
              <% for (let i = 1; i <= totalPages; i++) { %>
                <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                  <a class="page-link" href="/shop?page=<%= i %>"><%= i %></a>
                </li>
              <% } %>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</main>

<!--pagination-->



       
      
          <!-- <div class="sidebar-widget price_range range mb-30">
            <div class="widget-header position-relative mb-20 pb-10">
              <h5 class="widget-title mb-10">Fill by price</h5>
              <div class="bt-1 border-color-1"></div>
            </div>
            <div class="price-filter">
              <div class="price-filter-inner">
                <div id="slider-range"></div>
                <div class="price_slider_amount">
                  <div class="label-input">
                    <span>Range:</span><input
                      type="text"
                      id="amount"
                      name="price"
                      placeholder="Add Your Price"
                    />
                  </div>
                </div>
              </div>
            </div>
         
            <a href="/filterProducts" class="btn btn-sm btn-default" onclick="filterProducts()"
              ><i class="fi-rs-filter mr-5"></i> Filter</a>
          </div>  -->
        


      
        </div>
      </div>
    </div>
  </section>

</main>



  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<!-- Include jQuery UI for the slider -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script>

document.addEventListener("DOMContentLoaded", function () {
  const searchInput = document.getElementById("searchInput");
  const productGrid = document.getElementById("Grid");
  const productItems = productGrid.getElementsByClassName("col-lg-4 ");

  searchInput.addEventListener("input", function () {
    const searchText = searchInput.value.toLowerCase();

    for (let i = 0; i < productItems.length; i++) {
      const productName = products[i].querySelector("h2 a").textContent.toLowerCase();
      if (!searchText||productName.includes(searchText)) {
        productItems[i].style.display = "";
      } else {
        productItems[i].style.display = "none";
      }
    }
  });
})






// $(document).ready(function () {
//     // Initialize the price range slider
//     $("#slider-range").slider({
//       range: true,
//       min: 5000,
//       max: 100000, // Update the max value according to your product prices
//       values: [5000, 100000],
//       slide: function (event, ui) {
//         $("#amount").val("$" + ui.values[0] + " - $" + ui.values[1]);
//       },
//     });
//     $("#amount").val(
//       "$" + $("#slider-range").slider("values", 0) +
//       " - $" +
//       $("#slider-range").slider("values", 1)
//     );
//   });

  // function filterProducts() {
  //   // Get the price range values from the slider
  //   const minPrice = $("#slider-range").slider("values", 0);
  //   const maxPrice = $("#slider-range").slider("values", 1);

  //   // Send an AJAX request to filter products
  //   $.ajax({
  //     type: "POST",
  //     url: "/filterProducts", // Update the URL based on your server route
  //     data: { minPrice, maxPrice },
  //     success: function (data) {
  //       // Update the product list with the filtered data
  //       $("#.product-grid-3").html(data);
  //     },
  //     error: function (error) {
  //       console.error(error);
  //     },
  //   });
  // }



// function submitForm() {
//   var form = document.getElementById("myForm");
//   form.submit();
// }


</script> 
  
<%- include('../layouts/userfooter.ejs') %>
